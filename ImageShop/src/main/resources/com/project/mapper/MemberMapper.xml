<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mapper.MemberMapper">
	<!-- Member(1) : MemberAuth(N) ê´€ê³„ ë§¤í•‘ -->
	<!-- íšŒì› í•œ ëª…ì´ ì—¬ëŸ¬ ê°œì˜ ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ ìžˆëŠ” 1:N ê´€ê³„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤ -->

	<!-- íšŒì› ì •ë³´ ë§¤í•‘ (1ì— í•´ë‹¹) -->
	<resultMap type="Member" id="memberMap">
		<!-- â˜… ê¸°ë³¸ íšŒì› ì •ë³´ ë§¤í•‘ â˜… -->
		<!-- DB ì»¬ëŸ¼(user_no) â†’ ìžë°” ê°ì²´ì˜ í•„ë“œ(userNo)ë¡œ ë§¤í•‘ -->
		<result property="userNo" column="user_no" />
		<result property="userId" column="user_id" />
		<result property="userPw" column="user_pw" />
		<result property="userName" column="user_name" />
		<result property="job" column="job" />
		<result property="coin" column="coin" />
		<result property="enabled" column="enabled" />
		<result property="regDate" column="reg_date" />
		<result property="updDate" column="upd_date" />

		<!-- â˜…â˜…â˜… 1:N ê´€ê³„ ë§¤í•‘ì˜ í•µì‹¬ ë¶€ë¶„ â˜…â˜…â˜… -->
		<!-- collection: Member ê°ì²´ ì•ˆì— ì—¬ëŸ¬ ê°œì˜ ê¶Œí•œì„ List í˜•íƒœë¡œ ë‹´ê² ë‹¤ëŠ” ì˜ë¯¸ -->
		<!-- property="authList" : Member í´ëž˜ìŠ¤ì— ì •ì˜ëœ List<MemberAuth> íƒ€ìž…ì˜ í•„ë“œëª… -->
		<!-- resultMap="authMap" : ê°ê°ì˜ ê¶Œí•œ ì •ë³´ëŠ” ì•„ëž˜ ì •ì˜ëœ authMap ë°©ì‹ìœ¼ë¡œ ë§¤í•‘ -->
		<!-- ì¦‰, ì¡°íšŒëœ ì—¬ëŸ¬ ê°œì˜ ê¶Œí•œì„ authMap ë°©ì‹ìœ¼ë¡œ ë§¤í•‘í•´ì„œ Memberì˜ authList í•„ë“œì— ìžë™ìœ¼ë¡œ ë‹´ì•„ì¤Œ -->
		<collection property="authList" resultMap="authMap">
		</collection>
	</resultMap>

	<!-- ê¶Œí•œ ì •ë³´ ë§¤í•‘ (Nì— í•´ë‹¹) -->
	<resultMap type="MemberAuth" id="authMap">
		<!-- ê¶Œí•œ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ë“¤ì„ MemberAuth ê°ì²´ì˜ í•„ë“œì— ë§¤í•‘ -->
		<result property="userNo" column="user_no" />  <!-- ì–´ë–¤ íšŒì›ì˜ ê¶Œí•œì¸ì§€ -->
		<result property="auth" column="auth" />       <!-- ê¶Œí•œ ì´ë¦„ (ì˜ˆ: ROLE_USER, ROLE_ADMIN) -->
	</resultMap>


	<!-- ë“±ë¡ ì²˜ë¦¬ -->
	<insert id="create">
		INSERT INTO member (user_no, user_id, user_pw,
		user_name, job)
		VALUES ( member_seq.NEXTVAL, #{userId}, #{userPw},
		#{userName}, #{job})
	</insert>

	<insert id="createAuth">
		INSERT INTO member_auth VALUES (member_seq.CURRVAL,
		#{auth})
	</insert>

	<!-- ëª©ë¡ ì¡°íšŒ -->
	<select id="list" resultType="Member">
		SELECT user_no, user_id,
		user_pw,user_name,
		(SELECT code_name FROM code_detail WHERE group_code
		= 'A00' AND code_value = job) AS job,
		coin, reg_date FROM member ORDER
		BY reg_date DESC
	</select>

	<!-- ìƒì„¸ ì¡°íšŒ - íšŒì› 1ëª…ì˜ ì •ë³´ + í•´ë‹¹ íšŒì›ì˜ ëª¨ë“  ê¶Œí•œì„ í•¨ê»˜ ì¡°íšŒ -->
	<select id="read" resultMap="memberMap">
		<!-- ðŸ’¡ SELECT ì ˆ: member í…Œì´ë¸”ê³¼ member_auth í…Œì´ë¸”ì˜ ì»¬ëŸ¼ë“¤ì„ ëª¨ë‘ ì¡°íšŒ - member í…Œì´ë¸”ì˜ 
			ì»¬ëŸ¼ë“¤: mem.user_no, mem.user_id, user_pw, user_name, job, coin, reg_date, upd_date 
			- member_auth í…Œì´ë¸”ì˜ ì»¬ëŸ¼: auth (ê¶Œí•œëª…) â˜… ì¤‘ìš”: auth ì»¬ëŸ¼ì´ ì—†ìœ¼ë©´ ê¶Œí•œ ì •ë³´ê°€ ì¡°íšŒë˜ì§€ ì•Šì•„ì„œ authListê°€ 
			ë¹„ì–´ìžˆê²Œ ë¨ -->
		SELECT
		M.user_no,        <!-- íšŒì› ë²ˆí˜¸ (PK) -->
		user_id,         <!-- íšŒì› ì•„ì´ë”” -->
		user_pw,             <!-- ë¹„ë°€ë²ˆí˜¸ -->
		user_name,           <!-- ì´ë¦„ -->
		job,                 <!-- ì§ì—… -->
		coin,                <!-- ì½”ì¸ -->
		reg_date,            <!-- ë“±ë¡ì¼ -->
		upd_date,            <!-- ìˆ˜ì •ì¼ -->
		A.auth                 <!-- â˜… ê¶Œí•œëª… - ì´ ê°’ë“¤ì´ authListì— ìˆ˜ì§‘ë¨ â˜… -->
		FROM member M           <!-- member í…Œì´ë¸”ì„ ê¸°ì¤€ìœ¼ë¡œ -->
		LEFT OUTER JOIN member_auth A     <!-- member_auth í…Œì´ë¸”ì„ ì¡°ì¸ -->
		ON M.user_no = A.user_no  <!-- íšŒì› ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ëŠ” ì¡°ê±´ìœ¼ë¡œ -->
		WHERE M.user_no = #{userNo}     <!-- íŠ¹ì • íšŒì› 1ëª…ë§Œ ì¡°íšŒ -->
	</select>

	<select id="readByUserId" resultMap="memberMap">
		SELECT M.user_no, user_id,user_pw,user_name, job, coin, reg_date, upd_date, A.auth                 
		FROM member M           
		LEFT OUTER JOIN member_auth A 
		ON M.user_no = A.user_no  
		WHERE M.user_id = #{userId}    
	</select>

	<!-- ðŸ“Œ LEFT OUTER JOINì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ : - ê¶Œí•œì´ ì—†ëŠ” íšŒì›ë„ ì¡°íšŒë˜ë„ë¡ í•˜ê¸° ìœ„í•´ - ì˜ˆ: ê¶Œí•œì´ ì—†ëŠ” íšŒì›ì€ 
		auth ì»¬ëŸ¼ì´ NULLë¡œ ì¡°íšŒë˜ê³ , authListëŠ” ë¹ˆ ë¦¬ìŠ¤íŠ¸ê°€ ë¨ ðŸ“Œ ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ (user_no=1ì¸ íšŒì›): user_no 
		| user_id | user_name | auth 1 | hong | í™ê¸¸ë™ | ROLE_USER â† ì²« ë²ˆì§¸ ê¶Œí•œ 1 | hong 
		| í™ê¸¸ë™ | ROLE_ADMIN â† ë‘ ë²ˆì§¸ ê¶Œí•œ ðŸ“Œ MyBatis ì²˜ë¦¬ ê³¼ì •: 1. ì²« ë²ˆì§¸ í–‰: Member ê°ì²´ ìƒì„± + 
		"ROLE_USER" ê¶Œí•œì„ authListì— ì¶”ê°€ 2. ë‘ ë²ˆì§¸ í–‰: ê°™ì€ íšŒì›ìž„ì„ ì¸ì‹í•˜ê³  "ROLE_ADMIN" ê¶Œí•œë§Œ authListì— 
		ì¶”ê°€ 3. ìµœì¢…: Member ê°ì²´ 1ê°œì— authListì— 2ê°œì˜ ê¶Œí•œì´ ë‹´ê²¨ì„œ ë°˜í™˜ë¨ ðŸ“Œ resultMap="memberMap" 
		ì°¸ê³ : - memberMapì— ì •ì˜ëœ ëŒ€ë¡œ Member ê°ì²´ì™€ authListê°€ ìžë™ ë§¤í•‘ë¨ - collection ë¶€ë¶„ì´ ì—¬ëŸ¬ í–‰ì˜ 
		auth ê°’ì„ í•˜ë‚˜ì˜ Listë¡œ ë¬¶ì–´ì¤Œ -->


	<!-- ê¶Œí•œ ìˆ˜ì • -->
	<insert id="modifyAuth">
		INSERT INTO member_auth (user_no, auth)
		VALUES(#{userNo}, #{auth})
	</insert>

	<!-- ê¶Œí•œ ì‚­ì œ -->
	<delete id="deleteAuth">
		DELETE FROM member_auth
		WHERE user_no = #{userNo}
	</delete>

	<!-- ìˆ˜ì • ì²˜ë¦¬ -->
	<update id="modify">
		UPDATE member
		SET user_name = #{userName},
		job = #{job}
		WHERE user_no = #{userNo}
	</update>

	<!-- ì‚­ì œ ì²˜ë¦¬ -->
	<delete id="remove">
		DELETE FROM member WHERE user_no = #{userNo}
	</delete>

	<!-- íšŒì› í…Œì´ë¸”ì˜ ë°ì´í„° ê±´ìˆ˜ ì¡°íšŒ -->
	<select id="countAll" resultType="int">
		SELECT count(*)	FROM member
	</select>

</mapper>



